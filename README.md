adapt-contrib-spoor
===================
Tracking plugin for the Adapt Framework. Currently (officially) only supports SCORM 1.2

##Installation
If you haven't already done so, be sure to install the [Adapt Command Line Interface](https://github.com/adaptlearning/adapt-cli) then, from the command line run:-
```
$ adapt install adapt-contrib-spoor
```

This component can also be installed by adding the component to the adapt.json file before running `adapt install`:
```
"adapt-contrib-spoor": "*"
```

##Usage instructions
You will need to add the data that is in [example.json](example.json) to your course.json, amending the settings as required (see below).

Additionally, you must update your course to include tracking IDs in blocks.json - this should be done by running
```
$ rub --trackinginsert
```
or
```
$ grunt tracking-insert
```
or
```
$ gulp tracking-insert
```
from the command line.

###SCORM manifest file
You will also need to edit the manifest file [imsmanifest.xml](required/imsmanifest.xml) to contain information specific to your course.

A full description of the many ways this file can be set up and populated is beyond the scope of this README (see the [SCORM 1.2 documentation](http://www.adlnet.gov/resources/scorm-1-2-specification/), specifically the SCORM Content Aggregation Model (SCORM_1.2_CAM) for a full description) - however, at the very least you will likely want to change the course title (currently set to 'Adapt SCORM') and description (currently set to 'Responsive SCORM generated by the Adapt Framework').

##Settings overview
 
A complete example of this plugin's settings can be found in the [example.json](example.json) file.

##Settings explained
####_isEnabled
If set to `true`, the plugin will try to connect to a SCORM conformant LMS on course launch and perform tracking.

If you wish to switch off tracking without uninstalling the plugin - for example when testing locally with no LMS present - set this to `false`.

####_tracking
This section lists completion criteria and other tracking features such as whether to save a score back to the LMS or not.

#####_requireCourseCompleted
If set to `true`, the plugin will require that the user must complete all the components in the course before the course can be marked as finished in the LMS.

Note that if this setting and `_requireAssessmentPassed` (see below) are both set to `true`, the user must pass the course assessment as well as complete all components in order to meet the completion criteria.

#####_requireAssessmentPassed
If set to `true`, the plugin will require that the user must pass the course assessment before the course can be marked as finished in the LMS.

Note that if this setting and `_requireCourseCompleted` are both set to `true`, the user must complete all the components in the course as well as pass the assessment in order to meet the completion criteria.

#####_shouldSubmitScore
If set to `true`, the score attained in any assessment will be reported back to the LMS (regardless of whether the user passes or fails the assessment).

#####_extended
See the section [Extended Tracking](#user-content-extended-tracking) below

####_reporting
Defines what status to report back to the LMS

#####_onTrackingCriteriaMet
What status to report back to the LMS when the tracking criteria are met.

Valid values are: 'completed', 'passed', 'failed', and 'incomplete' (note - these must be lowercase).

Under most circumstances, if you are tracking a course by assessment, you would set this to 'passed'. Otherwise 'completed' is the usual value to use.

#####_onAssessmentFailure
What status to report back to the LMS when the assessment is failed.

Some Learning Management Systems will prevent the user from making further attempts at the course after it has been set to 'failed', it's therefore common to set this to 'incomplete' to allow the user more attempts to pass the assessment.

##Usage instructions
In order to get this to work in adapt_framework, your course will need tracking IDs, the insertion/removal of these can be automated using the <a href="https://github.com/cgkineo/adapt-grunt" target="_blank">tracking-insert:id</a> grunt task suite or this <a href="https://github.com/cgkineo/adapt-builder" target="_blank">tracking-insert</a> gulp task suite.

Then, after grunt dev, grunt build, gulp dev or gulp build has been run, all files from adapt-contrib-spoor/required will be copied into the root of the build folder.


###Extended tracking
By default, this extension will track only block completion and reinstates sub component ```_isComplete``` states.
To track question component scores and selections, use:
```
{
    "_spoor": {
        "_tracking": {
            "_extended": true
        }
}

```
This setting enables the extended tracking system. It tracks block completion as per the default setting - and also stores question component ```_score``` variables and (new) ```_selectionData``` variables. (A question component is any component which extends the questionView or, more simply, has ```_isQuestionType: true``` variable).

####Technical info on extended tracking
Component ```_selectionData``` variable:
  
This variable must be an array of booleans on the component model, with a maximum length of 28. It is the component's responsibility to create the ```_selectionData``` variable before completion and to reinstate the item selections from the ```_selectionData``` upon instantiation.

Component ```_score``` variable:
  
This can be the standard question component score. It is saved to the LMS as a value from 0-255 whereby a component score of 1 is saved to the LMS as a value of 100, a score of .2 is saved as a value of 20 and 2.55 is saved as a value of 255.
  
When using this extended storage mechanism it is important to keep block tracking ids consistent and component placement inside blocks consistent, such that ```b-01[tracking id: 1]{ c-01, c-02 }``` would be saved as ```tracking-id[index1,index2]```. Question component items must remain in their initial JSON order to preserve the relationship between user selection and storage. Question component item contents can be changed and items can be appended only or removed only from the end of the list without adverse effect to the course i.e. ```[item1(selected), item2, item3, item4(selected)]``` would be saved to the LMS as ```[true,false,false,true]```.
  
####Working specification:
  
On the premise that 1 hex byte is 4 binary bits or 0-15 as a decimal. i.e. 0-f = 0000-1111 = 0-15
  
The suspend data is saved to the LMS as a hex encoded string of binary switches, whereby a non-question-type component, or an incomplete question-type component occupies 1 byte(1 hex character) "0000" and a complete questiontype component will store a minimum of 3 bytes (3 hex characters) "1000|0000|0000".
A component is always represented by "0000" if it is incomplete, i.e. no score or user selections will be saved.
  
When a component's ```_selectionData``` and ```score``` are available for reinstantiation the following occurs:
```
    item.set('_attemptsLeft', 0);
    item.set('_buttonState', "submit");
    item.set("_score", score);
    if (score < 1) {
        item.set("_isCorrect", false);
    } else {
        item.set("_isCorrect", true);
    }
    item.set("_selectionData", selectionData);
    item.set("_isSubmitted", true);
```
  
The bits of each entry are representative of the following:
  
bit 0: 1 bit : _isComplete : 0/1

bit 1-3: 3 bits : the number of blocks required to store ```_selectionData``` array (where 1 block is half a byte "0000") : 100 = 1 block, 010 = 2 blocks, 111 = 7 blocks (giving ```4*7=28``` selections)

bit 4-11: 8 bits : ```_score``` : to store the component's ```Math.round(score*100)```

bit 12+: 4 bit blocks : ```_selectionData``` : representing the ```_selectionData``` array "1001" for four items where the first and last are selected
  
Example:
1010|1111|1111|1110|0110

This describes a question-type component which is completed, has a score of 2.55, has between 7 and 8 items - where the first three are selected, the next two are unselected, the following two are selected and the last may or may not exist but is unselected.

####Opportunities for alterations
1. To allow cookies to be used to store user completion+selection+score outside of an LMS environment for end users - obvious limitations are that a single client must be used to maintain progression.
2. To further compress the suspend data using a base 32 (0-9-a-w) encoding rather than base 16 (hex,0-9-a-f).
 
####Public interfaces

```
window.hex2bin("f") == "1111"
window.bin2hex("1111") == "f"

parseInt("hexstring", 16) //to convert hex to numbers
(number).toString(16) to //convert numbers to hex
```
Also coming is a public interface to marshall item selections like the slider 0-x values so that the number is stored as a binary digit in ```_selectionData``` rather than binary switches as with mcq item selection.

#####References
This plugin uses the excellent :sparkles: [pipwerks SCORM API Wrapper](https://github.com/pipwerks/scorm-api-wrapper/) for JavaScript :sparkles:
